<script type="module">
  // 1. استيراد الأدوات
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // 2. إعدادات مشروعك
  const firebaseConfig = {
    apiKey: "AIzaSyCDIizIvd_7nUT6B4sGIc_s-CnZ5hQECCg",
    authDomain: "pay-coins.firebaseapp.com",
    projectId: "pay-coins",
    storageBucket: "pay-coins.firebasestorage.app",
    messagingSenderId: "279908586614",
    appId: "1:279908586614:web:632ce326f8b3a0e0e47b57"
  };

  // 3. تشغيل Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 4. وظيفة الزر (تنهي Processing وترسل البيانات)
  window.withdrawAll = async function() {
    const address = document.getElementById('wallet-address').value;
    if (!address) { alert("Please enter address"); return; }

    const btn = document.querySelector('.withdraw-btn');
    btn.innerText = "Processing..."; // سيبدأ هنا

    try {
      await addDoc(collection(db, "withdrawals"), {
        address: address,
        timestamp: serverTimestamp()
      });
      btn.innerText = "✅ Success!"; // سينتهي هنا بنجاح
      alert("Request Sent!");
    } catch (e) {
      console.error(e);
      btn.innerText = "Withdraw All";
      alert("Error: " + e.message);
    }
  }
</script>
